<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Discipline KSA Generator (OpenAI)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .table-container { overflow-x: auto; }
        th, td { min-width: 150px; }
        .loader {
            border: 4px solid #e5e7eb; border-top: 4px solid #10a37f; /* OpenAI Green */
            border-radius: 50%; width: 40px; height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto px-4 py-8 md:py-12">
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-800">Multi-Discipline KSA Generator</h1>
            <p class="text-lg md:text-xl text-gray-600 mt-2">Powered by ChatGPT</p>
        </header>

        <main>
            <div id="main-app-screen">
                <div class="bg-white rounded-lg shadow-lg p-6 mb-8 max-w-3xl mx-auto">
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="ksa-selector" class="block text-lg font-medium text-gray-700 mb-2">Select Discipline:</label>
                            <select id="ksa-selector" class="w-full bg-white border border-gray-300 rounded-md px-4 py-2 text-gray-900 focus:ring-2 focus:ring-green-500 focus:outline-none transition">
                                <option value="cybersecurity">Cybersecurity</option>
                                <option value="systems-admin">Systems Administrator</option>
                                <option value="network-admin">Network Administrator</option>
                                <option value="project-manager">Project Manager</option>
                                <option value="desktop-support">Desktop Support</option>
                                <option value="help-desk">Help Desk</option>
                                <option value="technical-lead">Technical Lead</option>
                            </select>
                        </div>
                        <div>
                            <label for="app-password" class="block text-lg font-medium text-gray-700 mb-2">OpenAI API Key:</label>
                            <div class="relative">
                                <input type="password" id="app-password" class="w-full bg-white border border-gray-300 rounded-md pl-4 pr-12 py-2 text-gray-900 focus:ring-2 focus:ring-green-500 focus:outline-none transition" placeholder="sk-...">
                                <button type="button" id="toggle-password" class="absolute inset-y-0 right-0 px-3 flex items-center text-gray-500 hover:text-gray-700 focus:outline-none">
                                    <svg id="eye-icon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                                    <svg id="eye-slash-icon" class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"></path></svg>
                                </button>
                            </div>
                        </div>
                    </div>

                    <label for="ability-input" class="block text-lg font-medium text-gray-700 mb-2">Enter an Ability:</label>
                    <div class="flex flex-col sm:flex-row gap-4">
                        <input type="text" id="ability-input" class="w-full bg-white border border-gray-300 rounded-md px-4 py-2 text-gray-900 placeholder-gray-400 focus:ring-2 focus:ring-green-500 focus:outline-none transition" placeholder="e.g., Perform vulnerability scanning">
                        <button id="generate-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-md transition duration-300 ease-in-out transform hover:scale-105 shadow-md disabled:bg-gray-500 disabled:scale-100 disabled:cursor-not-allowed flex items-center justify-center">
                            <span id="btn-text">Generate</span>
                            <div id="btn-loader" class="loader w-5 h-5 border-2 border-t-2 hidden ml-2"></div>
                        </button>
                    </div>
                </div>

                <div id="results-container" class="bg-white rounded-lg shadow-2xl p-4 md:p-6 relative">
                      
                      <div id="loader" class="flex justify-center py-12 hidden">
                         <div class="loader"></div>
                      </div>

                      <div id="error-container" class="text-center py-12 text-red-600 hidden">
                         <p class="text-xl">An error occurred.</p>
                         <p id="error-message" class="text-sm text-gray-500 mt-2"></p>
                      </div>

                      <div id="results-header" class="hidden flex flex-col md:flex-row justify-between items-center mb-4 border-b pb-4">
                         <h2 id="table-title" class="text-2xl font-bold text-gray-900 mb-2 md:mb-0"></h2>
                         <button id="copy-btn" class="flex items-center px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-green-500 transition shadow-sm text-sm font-medium">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path></svg>
                            <span id="copy-btn-text">Copy Table to Clipboard</span>
                         </button>
                      </div>

                      <div id="table-wrapper" class="table-container hidden">
                        <table class="w-full text-sm text-left text-gray-700" id="ksa-table">
                            <thead class="text-xs text-white uppercase bg-gray-800">
                                <tr>
                                    <th scope="col" class="px-6 py-3">Discipline</th>
                                    <th scope="col" class="px-6 py-3">Level</th>
                                    <th scope="col" class="px-6 py-3">Role</th>
                                    <th scope="col" class="px-6 py-3">Knowledge</th>
                                    <th scope="col" class="px-6 py-3">Skill</th>
                                    <th scope="col" class="px-6 py-3">Training Source</th>
                                    <th scope="col" class="px-6 py-3">Training Link</th>
                                    <th scope="col" class="px-6 py-3">Technical Stack</th>
                                    <th scope="col" class="px-6 py-3">Description</th>
                                    <th scope="col" class="px-6 py-3">Demonstration</th>
                                </tr>
                            </thead>
                            <tbody id="ksa-table-body"></tbody>
                        </table>
                    </div>
                    <div id="no-results" class="text-center py-12 text-gray-500">
                        <p class="text-xl">Enter your API Key, select a discipline, and click "Generate".</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        const ksaSelector = document.getElementById('ksa-selector');
        const appPasswordInput = document.getElementById('app-password');
        const generateBtn = document.getElementById('generate-btn');
        const abilityInput = document.getElementById('ability-input');
        const tableBody = document.getElementById('ksa-table-body');
        const tableTitle = document.getElementById('table-title');
        const resultsHeader = document.getElementById('results-header');
        const noResultsDiv = document.getElementById('no-results');
        const tableWrapper = document.getElementById('table-wrapper');
        const mainLoader = document.getElementById('loader');
        const errorContainer = document.getElementById('error-container');
        const errorMessage = document.getElementById('error-message');
        const btnText = document.getElementById('btn-text');
        const btnLoader = document.getElementById('btn-loader');
        const copyBtn = document.getElementById('copy-btn');
        const copyBtnText = document.getElementById('copy-btn-text');
        
        // Toggle Password Logic
        const togglePasswordBtn = document.getElementById('toggle-password');
        const eyeIcon = document.getElementById('eye-icon');
        const eyeSlashIcon = document.getElementById('eye-slash-icon');

        togglePasswordBtn.addEventListener('click', () => {
            const type = appPasswordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            appPasswordInput.setAttribute('type', type);
            
            // Toggle Icons
            eyeIcon.classList.toggle('hidden');
            eyeSlashIcon.classList.toggle('hidden');
        });

        let currentKSAData = [];

        const generateKSA = async (ability, ksaType, apiKey) => {
            toggleLoading(true);
            
            // OpenAI API Endpoint
            const API_URL = 'https://api.openai.com/v1/chat/completions';

            // Constructing the Prompt for ChatGPT
            const systemPrompt = `
            You are an expert IT and Cybersecurity Competency Architect. 
            Your goal is to generate a Knowledge, Skills, and Abilities (KSA) matrix.
            
            Output MUST be a strict JSON array of objects. Do not include markdown formatting (like \`\`\`json).
            
            The JSON structure must be:
            [
              {
                "discipline": "String",
                "level": "String (e.g. Level 1, Level 2)",
                "role": "String (e.g. Junior Admin, Senior Engineer)",
                "knowledge": "String",
                "skill": "String",
                "trainingSource": "String",
                "trainingLink": "String (URL or N/A)",
                "techStack": "String",
                "description": "String",
                "demonstration": "String"
              }
            ]
            
            Generate 3 to 5 entries varying by experience level (Junior to Expert) for the requested discipline and ability.
            `;

            const userPrompt = `Discipline: ${ksaType}. Ability: ${ability}.`;

            const payload = {
                model: "gpt-4", // Or "gpt-3.5-turbo" if you want to save cost/tokens
                messages: [
                    { role: "system", content: systemPrompt },
                    { role: "user", content: userPrompt }
                ],
                temperature: 0.7
            };

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify(payload)
                });
                
                const result = await response.json();

                if (!response.ok) {
                    if(response.status === 401) {
                        throw new Error("Access Denied: Invalid API Key.");
                    }
                    throw new Error(result.error?.message || `Server error: ${response.status}`);
                }
                
                // Parsing OpenAI Response
                const content = result.choices[0].message.content;
                
                // Attempt to clean markdown if ChatGPT adds it despite instructions
                const cleanJson = content.replace(/```json/g, '').replace(/```/g, '').trim();
                
                let ksaData;
                try {
                    ksaData = JSON.parse(cleanJson);
                } catch (e) {
                    throw new Error("Failed to parse AI response. Try again.");
                }

                currentKSAData = ksaData;
                displayResults(ability, ksaData);

            } catch (error) {
                console.error('Error generating KSA:', error);
                displayError(error.message);
            } finally {
                toggleLoading(false);
            }
        };
        
        const displayResults = (ability, data) => {
            tableBody.innerHTML = ''; 
            const selectedText = ksaSelector.options[ksaSelector.selectedIndex].text;
            tableTitle.textContent = `${selectedText} KSA for: "${ability}"`;
            
            data.forEach(item => {
                const row = document.createElement('tr');
                row.className = 'bg-white border-b hover:bg-gray-50';
                const roleText = item.role.includes('[Number]') 
                    ? item.role.replace('[Number]', item.level.replace(/\D/g, '')) + ` - ${ability}`
                    : `${item.role} - ${ability}`;
                item.formattedRole = roleText;

                row.innerHTML = `
                    <td class="px-6 py-4 border-r">${item.discipline || ''}</td>
                    <td class="px-6 py-4 font-semibold text-green-600 border-r">${item.level}</td>
                    <td class="px-6 py-4 border-r">${roleText}</td>
                    <td class="px-6 py-4 border-r">${item.knowledge || ''}</td>
                    <td class="px-6 py-4 border-r">${item.skill || ''}</td>
                    <td class="px-6 py-4 border-r">${item.trainingSource || ''}</td>
                    <td class="px-6 py-4 border-r">${item.trainingLink && item.trainingLink !== 'N/A' ? `<a href="${item.trainingLink}" target="_blank" class="text-green-600 hover:underline">Link</a>` : 'N/A'}</td>
                    <td class="px-6 py-4 border-r">${item.techStack || ''}</td>
                    <td class="px-6 py-4 border-r">${item.description || ''}</td>
                    <td class="px-6 py-4">${item.demonstration || ''}</td>
                `;
                tableBody.appendChild(row);
            });
        };

        const displayError = (message) => {
            errorMessage.textContent = message;
            errorMessage.classList.add('font-bold'); 
        };

        const toggleLoading = (isLoading) => {
            if (isLoading) {
                generateBtn.disabled = true;
                btnText.classList.add('hidden');
                btnLoader.classList.remove('hidden');
                noResultsDiv.classList.add('hidden');
                errorContainer.classList.add('hidden');
                tableWrapper.classList.add('hidden');
                resultsHeader.classList.add('hidden');
                mainLoader.classList.remove('hidden');
            } else {
                mainLoader.classList.add('hidden');
                generateBtn.disabled = false;
                btnText.classList.remove('hidden');
                btnLoader.classList.add('hidden');
                if(tableBody.children.length > 0){
                    tableWrapper.classList.remove('hidden');
                    resultsHeader.classList.remove('hidden');
                } else {
                     errorContainer.classList.remove('hidden');
                     noResultsDiv.classList.add('hidden');
                }
            }
        };

        copyBtn.addEventListener('click', () => {
            if (!currentKSAData || currentKSAData.length === 0) return;
            const headers = ["Discipline", "Level", "Role", "Knowledge", "Skill", "Training Source", "Training Link", "Technical Stack", "Description", "Demonstration"].join("\t");
            const rows = currentKSAData.map(item => {
                return [
                    item.discipline || "", item.level || "", item.formattedRole || item.role,
                    (item.knowledge || "").replace(/(\r\n|\n|\r)/gm, " "), (item.skill || "").replace(/(\r\n|\n|\r)/gm, " "),
                    item.trainingSource || "", item.trainingLink || "",
                    (item.techStack || "").replace(/(\r\n|\n|\r)/gm, " "), (item.description || "").replace(/(\r\n|\n|\r)/gm, " "),
                    (item.demonstration || "").replace(/(\r\n|\n|\r)/gm, " ")
                ].join("\t");
            }).join("\n");
            navigator.clipboard.writeText(headers + "\n" + rows).then(() => {
                const originalText = copyBtnText.innerText;
                copyBtnText.innerText = "Copied to Excel!";
                copyBtn.classList.add('bg-green-50', 'text-green-700', 'border-green-200');
                setTimeout(() => { copyBtnText.innerText = originalText; copyBtn.classList.remove('bg-green-50', 'text-green-700', 'border-green-200'); }, 2000);
            });
        });

        generateBtn.addEventListener('click', () => {
            const ability = abilityInput.value.trim();
            const ksaType = ksaSelector.value;
            const apiKey = appPasswordInput.value.trim(); // Using the password field as API Key input
            
            if(!apiKey) {
                errorContainer.classList.remove('hidden');
                displayError("Please enter your OpenAI API Key.");
                return;
            }

            if (ability) {
                tableBody.innerHTML = ''; 
                currentKSAData = []; 
                generateKSA(ability, ksaType, apiKey);
            }
        });
        
        abilityInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                generateBtn.click();
            }
        });
    </script>
</body>
</html>
